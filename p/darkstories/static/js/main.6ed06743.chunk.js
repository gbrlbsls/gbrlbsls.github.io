(this["webpackJsonpdark-stories-front"]=this["webpackJsonpdark-stories-front"]||[]).push([[0],{30:function(t,e,n){},37:function(t,e,n){"use strict";n.r(e);var o=n(20),a=n.n(o),c=n(0),r=n(12),s=n(3),i=n(2),l=n(15),u=n(6),d=n.n(u),h=n(9),b=1e3,j=3;function p(t){return console.log(window.location),"".concat(window.location.host).concat(window.location.pathname,"#").concat(t)}function O(t){var e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(o){console.error("Fallback: Oops, unable to copy",o)}document.body.removeChild(e)}function f(t,e){return m.apply(this,arguments)}function m(){return m=Object(h.a)(d.a.mark((function t(e,n){var o,a,c,r,s,l,u,h=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=h.length>2&&void 0!==h[2]?h[2]:0,a=n.timeout,c=void 0===a?3e3:a,r=new AbortController,s=setTimeout((function(){return r.abort()}),c),t.prev=4,t.next=7,fetch(e,Object(i.a)(Object(i.a)({},n),{},{signal:r.signal}));case 7:l=t.sent,clearTimeout(s),t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(4),!(o<j&&t.t0 instanceof DOMException&&(null===(u=t.t0.message)||void 0===u?void 0:u.toString().includes("The operation was aborted")))){t.next=16;break}return console.log("fetchWithTimeout","timeout when fetching ".concat(e,", retrying... (").concat(o+1,"/").concat(j,")")),t.abrupt("return",f(e,Object(i.a)(Object(i.a)({},n),{},{timeout:2*c}),o+1));case 16:throw t.t0;case 17:return t.abrupt("return",l);case 18:case"end":return t.stop()}}),t,null,[[4,11]])}))),m.apply(this,arguments)}n(30);var g=n(1);function y(t){var e,n,o=t.loading?"skeleton-title":"",a=t.loading?"skeleton-content":"",c=[];if(t.loading)for(var r=0;r<(e=1,n=6,Math.random()*(n-e)+e);r++)c.push(Object(g.jsx)("span",{},r));function s(e){return t.loading?"":e}return Object(g.jsx)("div",{className:"row justify-content-center pt-3\tfont-monospace",style:{minHeight:"60vh"},children:Object(g.jsxs)("div",{className:"col-12",children:[Object(g.jsx)("div",{className:"row",children:Object(g.jsx)("div",{className:"col-md-12",children:Object(g.jsx)("span",{className:"text-start h4 "+o,children:s(t.title)})})}),Object(g.jsx)("hr",{}),Object(g.jsx)("div",{className:"row",children:Object(g.jsx)("div",{className:"col-md-8",children:Object(g.jsxs)("p",{className:"text-start lead fs-6 "+a,children:[t.loading&&c,s(t.content)]})})})]})})}var x=n(13),v=n(14),w=n(24),k=n(23),N=function(){function t(){Object(x.a)(this,t)}return Object(v.a)(t,null,[{key:"post",value:function(){var t=Object(h.a)(d.a.mark((function t(e){var n,o,a,c=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:null,o=c.length>2&&void 0!==c[2]?c[2]:{},a={body:JSON.stringify(n)},t.next=5,f("".concat(this.baseUrl).concat(e),Object(i.a)(Object(i.a)(Object(i.a)({},a),this._postRequestOptions),o));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"get",value:function(){var t=Object(h.a)(d.a.mark((function t(e){var n,o=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},t.next=3,f("".concat(this.baseUrl).concat(e),Object(i.a)(Object(i.a)({},this._getRequestOptions),n));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}();N.baseUrl="",N._defaultOptions={timeout:b},N._postRequestOptions=Object(i.a)(Object(i.a)({},N._defaultOptions),{},{method:"POST",headers:{"Content-Type":"application/json"}}),N._getRequestOptions=Object(i.a)(Object(i.a)({},N._defaultOptions),{},{method:"GET",mode:"cors",redirect:"follow",headers:{"Content-Type":"application/json"}});var C=function(t){Object(w.a)(n,t);var e=Object(k.a)(n);function n(){return Object(x.a)(this,n),e.apply(this,arguments)}return Object(v.a)(n,null,[{key:"newGame",value:function(){var t=Object(h.a)(d.a.mark((function t(){var e,n,o=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:null,n="",n=null!=e?"/game/new-game-from-story-hash":"/game/new-game",t.next=5,this.post(n,e);case 5:return t.abrupt("return",t.sent.json());case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getStoryById",value:function(){var t=Object(h.a)(d.a.mark((function t(e){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("/story/get-story-by-id?id=".concat(e));case 2:return t.next=4,t.sent.json();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),n}(N);C.baseUrl="https://hidden-wildwood-83104.herokuapp.com";var R=C;function S(){var t=Object(c.useState)({story:{id:0,title:"",content:"",resolution:"",hash:0},loading:!0,hiddenResolution:!0}),e=Object(l.a)(t,2),n=e[0],o=e[1],a=Object(s.f)().storyHash;function r(){o((function(t){return Object(i.a)(Object(i.a)({},t),{},{loading:!0,hiddenResolution:!0})})),R.newGame().then((function(t){o((function(e){return Object(i.a)(Object(i.a)({},e),{},{story:t.story,loading:!1,hiddenResolution:!0})})),window.story=t.story})).catch((function(t){console.log("newGame",{err:t}),o(Object(i.a)(Object(i.a)({},n),{},{loading:!1,story:{id:0,title:"Algo deu errado...",content:"N\xe3o foi poss\xedvel obter uma hist\xf3ria...",resolution:"Voc\xea se deu mal",hash:0}}))}))}function u(t){o((function(t){return Object(i.a)(Object(i.a)({},t),{},{hiddenResolution:!t.hiddenResolution})}))}function d(t){window.open("#story","_blank","height=480,width=480").story=window.story}function h(){O(p("story/".concat(window.story.id))),alert("Link para hist\xf3ria copiado!")}function b(){O(p("hash/".concat(window.story.hash))),alert("Link para jogo da hist\xf3ria copiado!")}return Object(c.useEffect)((function(){return null==a?r():(window.history.replaceState({},document.title,window.location.href.replace(window.location.hash,"#")),void R.newGame(a).then((function(t){o((function(e){return Object(i.a)(Object(i.a)({},e),{},{story:t.story,loading:!1,hiddenResolution:!0})})),window.story=t.story})).catch((function(t){console.log("loadGame",{err:t}),o(Object(i.a)(Object(i.a)({},n),{},{loading:!1,story:{id:0,title:"Algo deu errado...",content:"N\xe3o foi poss\xedvel obter uma hist\xf3ria...",resolution:"Voc\xea se deu mal",hash:0}}))})))}),[]),Object(g.jsx)("div",{children:Object(g.jsxs)("div",{className:"row row-cols-2",children:[Object(g.jsxs)("div",{className:"col-12 col-md-8",children:[Object(g.jsx)(y,{title:n.story.title,content:n.story.content,loading:n.loading}),!n.hiddenResolution&&Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("hr",{}),Object(g.jsx)("p",{className:"text-start lead fs-6",children:n.story.resolution})]})]}),Object(g.jsx)("div",{className:"col-12 col-md-4",children:Object(g.jsxs)("div",{className:"btn-group-vertical w-100 mt-3 pt-5",children:[Object(g.jsx)("button",{className:"btn btn-outline-light text-md-start",onClick:u,disabled:n.loading,children:"Mostrar resolu\xe7\xe3o"}),Object(g.jsx)("button",{className:"btn btn-outline-light text-md-start",onClick:d,disabled:n.loading,children:"Abrir resolu\xe7\xe3o"}),Object(g.jsx)("div",{className:"mb-1"}),Object(g.jsx)("button",{className:"btn btn-outline-light text-md-start",onClick:r,disabled:n.loading,children:"Novo jogo"}),Object(g.jsx)("button",{className:"btn btn-outline-light text-md-start",onClick:h,disabled:n.loading,children:"Compartilhar"}),Object(g.jsx)("div",{className:"mb-1"}),Object(g.jsx)("button",{className:"btn btn-outline-light text-md-start",onClick:b,disabled:n.loading,children:"Copiar jogo"})]})})]})})}function T(){var t=Object(s.f)().storyId,e=Object(c.useState)({story:{title:"-",content:"-",resolution:""},loading:!0}),n=Object(l.a)(e,2),o=n[0],a=n[1];return console.log("gameStory.mount"),Object(c.useEffect)((function(){null!=t&&R.getStoryById(parseInt(t)).then((function(t){a({story:t,loading:!1})})).catch((function(t){console.log({err:t}),a({story:{title:"Falha ao carregar...",content:"-",resolution:""},loading:!1})}))}),[t]),Object(c.useEffect)((function(){if(null==window.story)return;a({story:window.story,loading:!1})}),[]),Object(g.jsxs)("div",{children:[Object(g.jsx)(y,{title:o.story.title,content:o.story.content,loading:o.loading}),Object(g.jsx)("hr",{}),Object(g.jsx)("div",{className:"row",children:Object(g.jsx)("div",{className:"col-md-8",children:Object(g.jsx)("p",{className:"text-start lead fs-6",children:o.story.resolution})})})]})}console.log("App.tsx loaded");var _=function(){return Object(g.jsx)("div",{className:"container",children:Object(g.jsx)(r.a,{children:Object(g.jsxs)(s.c,{children:[Object(g.jsx)(s.a,{path:"/story/:storyId",component:T}),Object(g.jsx)(s.a,{path:"/story",component:T}),Object(g.jsx)(s.a,{path:"/hash/:storyHash",component:S}),Object(g.jsx)(s.a,{path:"/",component:S})]})})})};console.log("index.tsx loaded"),a.a.render(Object(g.jsx)(_,{}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.6ed06743.chunk.js.map